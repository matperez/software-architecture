# Recipe: PaaS with Cloud Foundry
 Cloud Foundry является еще одной платформой для микросервисов. В этой главе рассмотрим что такое PaaS, чем оно отличается от других окружений для запуска приложений и чем оно удобно конкретно для микросервисов.

## Определение PaaS
В облаках есть три типа предоставляемых услуг:

**IaaS** - инфраструктура как услуга, предоставляет вируальные ОС на которые можно установить собственное ПО, по сути это тоже самое, что и классическая виртуализация. Разница в том, что облачные решения могут взымать плату за фактически затраченное время работы ОС.

**SaaS** - ПО как услуга, предоставляет возможность аренды конкретного программного обеспечения. Например такого как сервер контроя версий или CI/CD.

**PaaS** означает платформа как услуга. Он предоставляет платформу на которой ваше собственное ПО может быть установлено и запущено.

Разработчик предоставляет само ПО, а платформа запускает его. В отличие от Docker и Kubenetes операционная система и запущенное на ней ПО не контролируется разработчиками.

Для запуска приложения PaaS может использовать контейнеры Docker, но их содержимое полностью определяется самой платформой.

![](attachments/Pasted%20image%2020220508163102.png)

PaaS ограничивает контроль и гибкость. С другой стороны, не факт, что разработчики вообще должны тратить свое время на настройку инфраструктуры.

Кроме того
* PaaS обеспечивают маршрутизацию запросов от пользователей к сервисам.
* Предоставлют дополнительные функции типа доступ к базам данных, мониторинг и логирование.

PaaS обычно предоставляется (и потребляется) как часть публично доступного облака. Так же PaaS можно установить и в собственном дата-центре.

По аналогии с Kubernetes PaaS влияет на макроархитектуру приложения.

## Cloud Foundry
[Cloud Foundry](https://www.cloudfoundry.org/) предоставляет PaaS для примера из этой главы. Он выбран по следующим причинам:
- Это Open Source проект
- Он просто в установке, в том числе для огранизации локального окружения разработчика
- Он часто используется и обладает всем функционалом, что обычно предоставляются подобныеми платформами.
- Он может быть установлен в собственном дата центре.

CF - это очень гибкое ПО:
- Он поддерживает множество языков программирования. Поддержка нового языка реализуется через [buildpacks](https://docs.cloudfoundry.org/buildpacks/)
- Можно создавать собственные buildpacks.
* Buildpacks могут задавать собственные ограничения по ресурсам.
* Также можно деплоить Docker контейнеры, хотя этот способ запуска и имеет некоторые ограничения.

## Пример с Cloud Foundry
Пример снова включает в себя несколько сервисов реализующих e-commerce продукт:
- Catalog управляет информацией о товарах
- Customer хранит информацию о пользователях
- Order создают новые заказы и обращается к сервисам Catalog и Customer с помощью REST.
- Дополнительно есть Hystrix Dashboard - Java приложение визуализирующее состоние Circuit Breaker'a.
- Наконец есть веб-страница "microservices" содержащая ссылки на микросервисы.

![](attachments/Pasted%20image%2020220508224226.png)

Исходный код можно найти тут [https://github.com/ewolff/microservice-cloudfoundry](https://github.com/ewolff/microservice-cloudfoundry). 

Для обнаружения сервисов используется DNS, микросервисы сами по себе не содержат зависимсостей от Cloud Foundry на уровне кода.

## Вариации
Кроме Cloud Foundry существуют и другие PaaS:
- OpenShift
- Amazon Elastic Beanstalk
- Heroku

## Serverless
В случае PaaS мы деплоим приложения. Serverless пошел еще дальше и позволяет деплоить отдельные функции.

Преимущества Serverless:
- Высокая степерь абстракции и относительно простой деплой
- Функции активируются только при использовани и при простое не потребляют денег
- Очень гибкие возможности для масштабирования

Serverless технологии включают в себя:
- [AWS Lambda](https://aws.amazon.com/lambda/)
- [Google Cloud Functions](https://cloud.google.com/functions/)
- [Azure Functions](https://azure.microsoft.com/services/functions/)
- [Apache OpenWhisk](https://developer.ibm.com/code/open/apache-openwhisk/) позволяет установить Serverless окружение в свой собственный датацентр

Так же как и PaaS Serverless предоставляют инструменты для логирования, инструментирования и мониторинга.

### REST с AWS Lambda и API gateway
С AWS Lambda можно реализовать REST сервисы. API гейтвей в AWS cloud могут вызывать функции Lambda.

Каждоую REST операцию можно реализовать отдельными функциями.

Часто Lambda функции могут существенно сократить затраты на функционирование.

